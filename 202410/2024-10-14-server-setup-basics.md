# Server Setup Basics
- URL: https://becomesovran.com/blog/server-setup-basics.html
- Added At: 2024-10-14 00:13:30
- [Link To Text](2024-10-14-server-setup-basics_raw.md)

## TL;DR
文章详细介绍了自托管应用的服务器设置，包括SSH安全登录、用户管理、日志轮转、备份策略、网络安全、NGINX配置等，并推荐了多种工具和自动化脚本，以简化设置过程并持续优化服务器性能。

## Summary
1. **服务器设置基础**：
   - **目的**：解释如何为自托管应用设置服务器，确保应用建立在稳固的基础上。
   - **内容**：涵盖SSH登录、非root用户设置、用户管理、NGINX配置、日志管理、备份策略、基本网络安全等。

2. **SSH登录**：
   - **安全登录**：使用SSH密钥进行登录，禁用用户名和密码登录。
   - **步骤**：
     - 创建新用户并添加到sudo组。
     - 生成SSH密钥对并复制公钥到服务器。
     - 修改SSH配置文件，禁用root登录和密码认证。
     - 重启SSH服务并测试登录。

3. **用户管理**：
   - **最小权限原则**：为每个应用创建独立用户，限制权限。
   - **步骤**：
     - 使用`sudo useradd`命令创建用户，并设置不允许登录。
     - 将应用文件克隆到/opt目录，并设置用户权限。

4. **日志管理**：
   - **日志轮转**：设置日志轮转以防止日志占用过多空间。
   - **配置**：编辑`logrotate.conf`文件，设置日志轮转策略。
   - **工具**：推荐使用Grafana Loki、Graylog和Fluentd等工具进行多服务器日志管理。

5. **备份策略**：
   - **备份类型**：包括全量备份、差异备份和增量备份。
   - **存储策略**：遵循3-2-1规则，即3份数据、2种存储类型、1份异地备份。
   - **工具**：推荐使用Syncthing、Borg Backup和FTP等工具进行备份。

6. **基本网络安全**：
   - **防火墙**：使用UFW设置默认拒绝入站规则，允许出站规则。
   - **工具**：使用UFW和Fail2Ban进行端口管理和IP封禁。
   - **配置**：
     - 允许SSH、HTTP和HTTPS端口。
     - 使用`sudo ufw limit ssh`限制SSH端口连接。

7. **NGINX配置**：
   - **功能**：作为Web服务器、反向代理和负载均衡器。
   - **配置**：
     - 使用`sites-available`和`sites-enabled`目录管理站点配置。
     - 提供静态网站、代理转发和WebSocket升级的配置示例。
   - **SSL**：使用Certbot自动获取和更新SSL证书。

8. **质量提升工具**：
   - **资源监控**：使用Btop监控系统资源。
   - **连接管理**：使用Neoss监控TCP和UDP连接。
   - **日志分析**：使用GoAccess进行实时日志分析。
   - **文件管理**：使用MC和NCDU进行文件和磁盘管理。

9. **DNS基础**：
   - **功能**：将域名解析为IP地址。
   - **配置**：设置A记录指向服务器IP。
   - **动态DNS**：使用DDNS解决动态IP问题。

10. **Docker**：
    - **优点**：一致性、隔离性、资源效率、易于扩展、社区支持。
    - **缺点**：资源开销、安全风险、数据持久化复杂、网络配置复杂、监控和调试复杂。

11. **总结**：
    - **自动化脚本**：提供一个自动化脚本，简化服务器设置过程。
    - **持续优化**：根据需求不断调整和优化服务器设置。
