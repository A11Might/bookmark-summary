# ISO 8583: The language of credit cards — Increase
- URL: https://increase.com/articles/iso-8583-the-language-of-credit-cards
- Added At: 2024-12-19 00:16:35
- [Link To Text](2024-12-19-iso-8583-the-language-of-credit-cards-—-increase_raw.md)

## TL;DR
ISO 8583是用于信用卡网络消息传输的标准，自1987年定义以来不断扩展，支持多种消息格式和嵌套数据。通过位图、TLV等技术，实现高效、灵活的消息解析和传输，确保全球支付系统的兼容性和安全性。

## Summary
1. **ISO 8583简介**：
   - ISO 8583是用于实时消息传输的标准，主要用于信用卡网络中，连接收单行和发卡行的消息通信。
   - 每次刷卡或在线支付时，消息最终会以ISO 8583格式在商户的收单处理器、卡网络和银行的发卡处理器之间传递。

2. **历史背景**：
   - ISO 8583标准于1987年首次定义，包含了消息的整体结构和核心字段的名称及长度。
   - 随着时间的推移，标准增加了更多字段，减少了网络特定行为的需求，但仍然保留了1987年版本的基本规则。

3. **消息格式**：
   - ISO 8583消息由多个部分组成，包括消息类型指示符、位图和数据元素。
   - 消息类型指示符是一个四位数的代码，用于标识消息类型，如授权请求或撤销请求。
   - 位图用于指示哪些字段存在，哪些字段缺失。

4. **数据元素**：
   - 数据元素可以是简单的（如字符串或整数）或复杂的（包含嵌套字段）。
   - 字段的序列化方式因网络而异，常见的编码方式包括EBCDIC、BCD和二进制。

5. **嵌套消息**：
   - 为了应对标准中预定义字段的限制，ISO 8583允许使用“私有使用”字段来传递自定义数据。
   - 嵌套消息的序列化方式有三种：表格、嵌套位图消息和标签长度值（TLV）消息。

6. **表格格式**：
   - 表格格式是最简单的嵌套消息类型，每个字段通常是固定长度的，并且总是包含在消息中。
   - 变长表格允许发送者省略某些字段，但需要通过长度指示符来告知接收者。

7. **嵌套位图消息**：
   - 嵌套位图消息通过在数据元素前添加位图来指示哪些字段存在，从而避免了发送空值的浪费。
   - 这种格式保留了向后兼容性，允许网络在不破坏现有实现的情况下添加新字段。

8. **标签长度值（TLV）消息**：
   - TLV格式是ISO 8583标准的最新扩展，每个字段被序列化为包含标签、长度和值的元组。
   - TLV格式具有最大的灵活性，允许发送者以任意顺序序列化字段，且接收者可以根据标签识别字段。

9. **消息的帧和网络特定头部**：
   - ISO 8583消息通常通过长期存在的TCP套接字传输，需要通过长度指示符来标识消息的开始和结束。
   - 一些卡网络（如Visa）在消息前添加了网络特定头部，包含元信息如消息的来源和目的地。

10. **解析器的构建**：
    - 解析ISO 8583消息需要实现位图解析器和每个字段的长度定义。
    - 使用类型安全的编程语言（如Ruby和Sorbet）可以简化解析器的实现，并确保类型安全。

11. **错误处理**：
    - 在解析嵌套字段时，错误处理至关重要，特别是在处理来自全球不同收单行的授权请求时。
    - 解析器应能够记录未处理的标签或字段，并在可能的情况下继续解析后续字段，以确保消息的完整性。

12. **结论**：
    - ISO 8583标准自1987年定义以来，经历了多次扩展和改进，以适应不断发展的信用卡网络需求。
    - Increase通过自动解析卡网络消息，帮助开发者专注于构建产品，同时保持对底层细节的透明性。
